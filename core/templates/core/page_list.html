{% extends "core/base.html" %}

{% block title %}Mes Pages - Hypostasia{% endblock %}

{% block content %}
<div class="row mb-4 align-items-center">
    <div class="col">
        <h1 class="h3 mb-0">Mes Lectures</h1>
    </div>
</div>

<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 row-cols-xl-4 g-4">
    {% for page in pages %}
    <div class="col">
        <div class="card h-100 shadow-sm border-0 transition-hover overflow-hidden">
            <!-- Image Header -->
            {% if page.first_image_url %}
            <div style="height: 160px; overflow: hidden; background-color: #e9ecef;">
                <img src="{{ page.first_image_url }}" class="w-100 h-100 object-fit-cover" alt="Article image">
            </div>
            {% else %}
            <div
                style="height: 160px; background-color: #e9ecef; display: flex; align-items: center; justify-content: center;">
                <span class="text-muted small">Aucune image</span>
            </div>
            {% endif %}

            <div class="card-body">
                <!-- Date Badge -->
                <span class="badge bg-light text-dark border mb-2">{{ page.created_at|date:"d M Y" }}</span>

                <!-- Title -->
                <h5 class="card-title text-truncate-2-lines mb-2" title="{{ page.title|default:page.url }}">
                    <a href="/api/pages/{{ page.id }}/" class="text-decoration-none text-reset stretched-link">
                        {{ page.title|default:page.url|truncatechars:60 }}
                    </a>
                </h5>

                <!-- Extract Snippet -->
                <p class="card-text text-muted small text-truncate-3-lines mb-3">
                    {{ page.text_readability|striptags|truncatewords:25 }}
                </p>

                <!-- URL Domain & Status -->
                <div class="d-flex justify-content-between align-items-center mt-auto">
                    <small class="text-primary fw-bold">
                        <img src="https://www.google.com/s2/favicons?domain={{ page.domain }}" width="16" height="16"
                            class="me-1">
                        {{ page.domain }}
                    </small>

                    <span
                        class="badge rounded-pill {% if page.status == 'completed' %}text-bg-success{% elif page.status == 'error' %}text-bg-danger{% else %}text-bg-secondary{% endif %}">
                        {{ page.arguments.count }} args
                    </span>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<style>
    .transition-hover {
        transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    }

    .transition-hover:hover {
        transform: translateY(-4px);
        box-shadow: 0 1rem 3rem rgba(0, 0, 0, .175) !important;
    }

    .object-fit-cover {
        object-fit: cover;
    }

    .text-truncate-2-lines {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .text-truncate-3-lines {
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>
{% endblock %}