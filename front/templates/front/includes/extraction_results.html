{# Partial: Resultats d'extraction dans le panneau droit (light theme) #}
{# Reutilise _card_body.html pour le meme rendu que l'editeur d'analyseur #}
{# / Partial: Extraction results in right panel (light theme) #}
{# / Reuses _card_body.html for same rendering as analyzer editor #}
{% load extractor_tags %}
<div class="space-y-3" id="extraction-results">
    {% if error_message %}
    <div class="bg-red-50 border border-red-200 rounded-xl p-4">
        <p class="text-sm text-red-600 font-medium">Erreur lors de l'extraction</p>
        <p class="text-xs text-red-500 mt-1">{{ error_message|truncatechars:200 }}</p>
    </div>

    {% elif entities %}
        {% for entity in entities %}
        {# Extraire les 4 premiers attributs du JSONField par ordre de cle #}
        {# / Extract first 4 attributes from JSONField by key order #}
        {% entity_json_attrs entity as entity_attrs %}
        <div class="extraction-card bg-white rounded-lg border border-slate-200 p-3 hover:shadow-sm transition-shadow cursor-pointer relative group"
             data-extraction-id="{{ entity.pk }}">

            {# Bouton editer (visible au hover) / Edit button (visible on hover) #}
            <button class="btn-editer-extraction absolute top-2 right-2 p-1 rounded text-slate-300 hover:text-blue-500 hover:bg-blue-50 opacity-0 group-hover:opacity-100 transition-opacity"
                    data-entity-id="{{ entity.pk }}"
                    data-page-id="{{ entity.job.page_id }}"
                    title="Modifier cette extraction">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931z"/>
                </svg>
            </button>

            {% with attr_0=entity_attrs.0 attr_1=entity_attrs.1 text=entity.extraction_text attr_2=entity_attrs.2 attr_3=entity_attrs.3 %}
                {% include "hypostasis_extractor/includes/_card_body.html" %}
            {% endwith %}

            <div class="text-[10px] text-slate-400 mt-1">pos {{ entity.start_char }}-{{ entity.end_char }}</div>
        </div>
        {% empty %}
        <div class="text-center py-8 text-slate-400 border border-dashed border-slate-200 rounded-xl">
            <p class="text-sm">Aucune entite extraite.</p>
        </div>
        {% endfor %}

    {% else %}
    <div class="text-center py-8 text-slate-400 border border-dashed border-slate-200 rounded-xl">
        <p class="text-sm">Lancez une analyse pour voir les resultats ici.</p>
    </div>
    {% endif %}
</div>
