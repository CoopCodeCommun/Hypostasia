{# Partial : confirmation avant lancement d'une analyse IA #}
{# Affiche le modele, les tokens, le cout estime, et un bouton pour voir le prompt #}
{# / Partial: confirmation before launching an AI analysis #}
{# / Shows model, tokens, estimated cost, and a button to view the prompt #}

<div class="bg-white rounded-lg border border-indigo-200 p-4 space-y-3" id="confirmation-analyse">

    {# En-tete / Header #}
    <div class="flex items-center gap-2">
        <svg class="w-5 h-5 text-indigo-500 shrink-0" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z"/>
        </svg>
        <h3 class="text-sm font-semibold text-slate-800">Confirmer l'analyse</h3>
    </div>

    {# Infos resume / Summary info #}
    <div class="bg-slate-50 rounded p-3 space-y-1.5 text-xs text-slate-600">
        <div class="flex justify-between">
            <span>Analyseur</span>
            <span class="font-medium text-slate-800">{{ analyseur.name }}</span>
        </div>
        <div class="flex justify-between">
            <span>Modèle IA</span>
            <span class="font-medium text-slate-800">{{ modele_ia.get_display_name }}</span>
        </div>
        <div class="flex justify-between">
            <span>Pièces de prompt</span>
            <span class="font-medium text-slate-800">{{ nombre_pieces }}</span>
        </div>
        <div class="flex justify-between">
            <span>Exemples few-shot</span>
            <span class="font-medium text-slate-800">{{ nombre_exemples }}</span>
        </div>
    </div>

    {# Estimation tokens et cout / Token and cost estimate #}
    <div class="bg-amber-50 border border-amber-200 rounded p-3 space-y-1.5 text-xs">
        <div class="flex justify-between text-amber-800">
            <span>Tokens input estimés</span>
            <span class="font-bold">{{ nombre_tokens_input|floatformat:0 }}</span>
        </div>
        <div class="flex justify-between text-amber-700">
            <span>Tokens output estimés (~20%)</span>
            <span class="font-medium">~{{ nombre_tokens_output_estime|floatformat:0 }}</span>
        </div>
        <div class="flex justify-between text-amber-900 border-t border-amber-200 pt-1.5 mt-1.5">
            <span class="font-semibold">Coût estimé</span>
            <span class="font-bold">~{{ cout_estime_euros|floatformat:5 }} €</span>
        </div>
    </div>

    {# Bouton pour voir le prompt complet dans une modale scrollable #}
    {# / Button to view the full prompt in a scrollable modal #}
    <button type="button"
            class="btn-voir-prompt-complet w-full text-xs text-slate-500 hover:text-indigo-600 hover:bg-indigo-50 border border-slate-200 rounded px-3 py-1.5 transition-colors"
            data-prompt-visible="false">
        Voir le prompt complet
    </button>

    {# Zone cachee du prompt complet (modale inline scrollable) #}
    {# / Hidden zone for the full prompt (inline scrollable modal) #}
    <div id="zone-prompt-complet" class="hidden">
        <div class="bg-slate-900 text-slate-100 rounded-lg p-4 max-h-96 overflow-y-auto text-xs font-mono whitespace-pre-wrap leading-relaxed">{{ prompt_complet }}</div>
    </div>

    {# Boutons d'action / Action buttons #}
    <div class="flex gap-2 pt-1">
        <button type="button"
                hx-post="/lire/{{ page.pk }}/analyser/"
                hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
                hx-vals='{"analyseur_id": "{{ analyseur.id }}"}'
                hx-target="#zone-resultats-extraction"
                hx-swap="innerHTML"
                class="flex-1 px-3 py-1.5 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded transition-colors">
            Lancer l'analyse
        </button>
        <button type="button"
                class="btn-annuler-analyse flex-1 px-3 py-1.5 text-sm font-medium text-slate-600 bg-slate-100 hover:bg-slate-200 rounded transition-colors">
            Annuler
        </button>
    </div>
</div>

<script>
(function() {
    // Toggle du prompt complet / Toggle full prompt visibility
    var boutonVoirPrompt = document.querySelector('.btn-voir-prompt-complet');
    var zonePrompt = document.getElementById('zone-prompt-complet');
    if (boutonVoirPrompt && zonePrompt) {
        boutonVoirPrompt.addEventListener('click', function() {
            var estVisible = zonePrompt.classList.toggle('hidden');
            boutonVoirPrompt.textContent = estVisible ? 'Voir le prompt complet' : 'Masquer le prompt';
        });
    }

    // Bouton Annuler : vide la zone de confirmation
    // / Cancel button: clear the confirmation zone
    var boutonAnnuler = document.querySelector('.btn-annuler-analyse');
    if (boutonAnnuler) {
        boutonAnnuler.addEventListener('click', function() {
            var zoneConfirmation = document.getElementById('confirmation-analyse');
            if (zoneConfirmation) zoneConfirmation.remove();
        });
    }
})();
</script>
