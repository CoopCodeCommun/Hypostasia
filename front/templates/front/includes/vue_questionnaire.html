{# Partial: Onglet questionnaire — liste des questions + formulaire de creation #}
{# / Partial: Questionnaire tab — questions list + creation form #}

<div class="space-y-4">

    {# Formulaire de creation d'une nouvelle question #}
    {# / New question creation form #}
    <form hx-post="/questionnaire/poser_question/"
          hx-target="#panneau-extractions"
          hx-swap="innerHTML"
          class="bg-white border border-slate-200 rounded-lg p-3 space-y-2">
        <input type="hidden" name="page_id" value="{{ page.pk }}">
        <input type="text" name="prenom" placeholder="Votre prenom"
               class="w-full text-sm border border-slate-300 rounded px-2 py-1.5 focus:outline-none focus:ring-1 focus:ring-indigo-400"
               required>
        <textarea name="texte_question" rows="2" placeholder="Posez votre question sur ce texte…"
                  class="w-full text-sm border border-slate-300 rounded px-2 py-1.5 focus:outline-none focus:ring-1 focus:ring-indigo-400 resize-none"
                  required></textarea>
        <button type="submit"
                class="w-full bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-medium rounded px-3 py-1.5 transition-colors">
            Poser une question
        </button>
    </form>

    {# Liste des questions avec leurs reponses #}
    {# / Questions list with their answers #}
    {% if toutes_les_questions %}
    <div class="space-y-4">
        {% for question in toutes_les_questions %}
        <div class="bg-white border border-slate-200 rounded-lg p-3 space-y-3">

            {# En-tete de la question / Question header #}
            <div>
                <div class="flex items-center justify-between mb-1">
                    <span class="text-xs font-semibold text-indigo-700">{{ question.prenom }}</span>
                    <span class="text-[10px] text-slate-400">{{ question.created_at|date:"d/m H:i" }}</span>
                </div>
                <p class="text-sm text-slate-800 font-medium">{{ question.texte_question }}</p>
            </div>

            {# Reponses existantes / Existing answers #}
            {% for reponse in question.reponses.all %}
            <div class="ml-6 border-l-2 border-indigo-100 pl-3">
                <div class="flex items-center justify-between mb-0.5">
                    <span class="text-xs font-semibold text-slate-600">{{ reponse.prenom }}</span>
                    <span class="text-[10px] text-slate-400">{{ reponse.created_at|date:"d/m H:i" }}</span>
                </div>
                <p class="text-sm text-slate-600 whitespace-pre-wrap">{{ reponse.texte_reponse }}</p>
            </div>
            {% endfor %}

            {# Formulaire de reponse repliable / Collapsible answer form #}
            <details class="ml-6">
                <summary class="text-xs text-indigo-500 hover:text-indigo-700 font-medium cursor-pointer">
                    Repondre
                </summary>
                <form hx-post="/questionnaire/repondre/"
                      hx-target="#panneau-extractions"
                      hx-swap="innerHTML"
                      class="mt-2 space-y-2">
                    <input type="hidden" name="question_id" value="{{ question.pk }}">
                    <input type="text" name="prenom" placeholder="Votre prenom"
                           class="w-full text-sm border border-slate-300 rounded px-2 py-1.5 focus:outline-none focus:ring-1 focus:ring-indigo-400"
                           required>
                    <textarea name="texte_reponse" rows="2" placeholder="Votre reponse…"
                              class="w-full text-sm border border-slate-300 rounded px-2 py-1.5 focus:outline-none focus:ring-1 focus:ring-indigo-400 resize-none"
                              required></textarea>
                    <button type="submit"
                            class="w-full bg-indigo-500 hover:bg-indigo-600 text-white text-xs font-medium rounded px-2 py-1 transition-colors">
                        Envoyer
                    </button>
                </form>
            </details>

        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="flex flex-col items-center justify-center py-8 text-center">
        <svg class="w-10 h-10 text-slate-300 mb-3" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z"></path>
        </svg>
        <p class="text-sm text-slate-400">Aucune question pour le moment.</p>
        <p class="text-xs text-slate-300 mt-1">Posez la premiere question ci-dessus.</p>
    </div>
    {% endif %}

</div>
