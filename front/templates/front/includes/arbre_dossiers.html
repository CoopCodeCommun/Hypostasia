{% for dossier in dossiers %}
<div class="dossier-node mb-1">
    <div class="dossier-toggle flex items-center gap-1 py-1 px-1 rounded hover:bg-slate-200 cursor-pointer group">
        <svg class="tree-arrow w-3 h-3 text-slate-400 shrink-0" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd" />
        </svg>
        <svg class="w-4 h-4 text-slate-400 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>
        </svg>
        <span class="text-sm text-slate-700 truncate flex-1">{{ dossier.name }}</span>
        <span class="text-xs text-slate-400">{{ dossier.pages.count }}</span>
    </div>
    <ul class="dossier-pages hidden ml-5 border-l border-slate-200 pl-2">
        {% for page in dossier.pages.all %}
        <li class="py-0.5 flex items-center gap-1 group">
            <button class="btn-classer shrink-0 text-slate-300 hover:text-blue-500 opacity-50 group-hover:opacity-100 transition-opacity"
                    data-page-id="{{ page.pk }}" title="DÃ©placer">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M5 9l-3 3 3 3M9 5l3-3 3 3M15 19l-3 3-3-3M19 9l3 3-3 3M2 12h20M12 2v20"/>
                </svg>
            </button>
            <button class="btn-supprimer-page shrink-0 text-slate-300 hover:text-red-500 opacity-50 group-hover:opacity-100 transition-opacity"
                    data-page-id="{{ page.pk }}" title="Supprimer">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
            <a href="#" class="lien-page text-sm text-slate-600 hover:text-blue-600 truncate block flex-1"
               data-page-id="{{ page.pk }}"
               hx-get="/lire/{{ page.pk }}/" hx-target="#zone-lecture" hx-swap="innerHTML" hx-push-url="true">
                {% if page.source_type == 'audio' %}<span class="text-slate-400 mr-0.5" title="Audio transcrit">ğŸ™ï¸</span>{% elif page.source_type == 'file' %}<span class="text-slate-400 mr-0.5" title="Fichier importÃ©">ğŸ“„</span>{% endif %}{{ page.title|default:page.domain|truncatechars:30 }}
            </a>
        </li>
        {% empty %}
        <li class="text-xs text-slate-400 py-0.5 italic">Vide</li>
        {% endfor %}
    </ul>
</div>
{% endfor %}

{% if pages_orphelines %}
<div class="mt-3 pt-2 border-t border-slate-200">
    <p class="text-xs font-semibold uppercase tracking-wider text-slate-400 mb-1">Non classÃ©es</p>
    {% for page in pages_orphelines %}
    <div class="py-0.5 flex items-center gap-1 group">
        <button class="btn-classer shrink-0 text-slate-300 hover:text-blue-500 opacity-50 group-hover:opacity-100 transition-opacity"
                data-page-id="{{ page.pk }}" title="DÃ©placer">
            <svg class="w-3 h-3" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M5 9l-3 3 3 3M9 5l3-3 3 3M15 19l-3 3-3-3M19 9l3 3-3 3M2 12h20M12 2v20"/>
            </svg>
        </button>
        <button class="btn-supprimer-page shrink-0 text-slate-300 hover:text-red-500 opacity-50 group-hover:opacity-100 transition-opacity"
                data-page-id="{{ page.pk }}" title="Supprimer">
            <svg class="w-3 h-3" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
            </svg>
        </button>
        <a href="#" class="lien-page text-sm text-slate-600 hover:text-blue-600 truncate block flex-1"
           data-page-id="{{ page.pk }}"
           hx-get="/lire/{{ page.pk }}/" hx-target="#zone-lecture" hx-swap="innerHTML" hx-push-url="true">
            {% if page.source_type == 'file' %}<span class="text-slate-400 mr-0.5" title="Fichier importÃ©">ğŸ“„</span>{% endif %}{{ page.title|default:page.domain|truncatechars:30 }}
        </a>
    </div>
    {% endfor %}
</div>
{% endif %}

{% if not dossiers and not pages_orphelines %}
<p class="text-xs text-slate-400 italic">Aucune page enregistrÃ©e.</p>
{% endif %}
